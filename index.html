<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <calendar-element></calendar-element>
    <p class="week">Test leaking out styles</p>

    <!--It is a mess to get Firefox to work :(-->
    <!--<script src="https://unpkg.com/@webcomponents/custom-elements@latest"></script>-->
    <!--<script src="https://unpkg.com/@webcomponents/shadydom@latest"></script>-->
    <script src="dist/bundle.min.js"></script>
    <script>
      class CalendarElement extends HTMLElement {
        constructor() {
          super() // always call super() first in the ctor.

          // TODO: make this dynamic
          this.year = 2017
          this.month = 7

          const isCurrentMonth = (day, month) => day.month.month === month
          const isWeekend = (day) => day.dayInWeek === 6 || day.dayInWeek === 0

          const calendarDays = window.cntdys.calendarMonth(this.year, this.month)
          const days = `<div class="weeks">
            ${calendarDays
              .map(week => `
                <div class="week">${week.map(day => 
                  `<span class="day${isWeekend(day) ? ' weekend' : ''}${isCurrentMonth(day, this.month) ? ' current-month' : ' other-month'}">${day.dayInMonth}</span>`)
                  .join('')}
                </div>`
              )
              .join('')}
          </div>`

          const header = `<div class="header">
            <span>${this.year} - ${this.month}</span>
            <div class="week">
              <span class="day day-name">Mo</span>
              <span class="day day-name">Tu</span>
              <span class="day day-name">We</span>
              <span class="day day-name">Th</span>
              <span class="day day-name">Fr</span>
              <span class="day day-name">Sa</span>
              <span class="day day-name">Su</span>
            </div>
          </div>`
          const style = `<style>
            :host {
              --main-color: #e4e7e7;
              --other-day-color: #cacccd;
              --cell-size: 37px;
              display: inline-block;
            }
            .weeks {
              border-left: 1px solid var(--main-color);
              border-right: 1px solid var(--main-color);
            }
            .week {
              display: flex;
              border-bottom: 1px solid var(--main-color);
            }
            .day {
              width: var(--cell-size);
              height: var(--cell-size);
              text-align: center;
              border-right: 1px solid var(--main-color);
              display: flex;
              align-self: center;
              justify-content: center;
              flex-direction: column;
            }
            .day.day-name {
              border-right: 1px solid transparent;
            }
            .day:last-child {
              border-right: 1px solid transparent;
            }
            .day:hover {
              cursor: default;
            }
            .day.current-month:hover {
              cursor: pointer;
              background-color: var(--main-color);
            }
            .other-month {
              color: var(--other-day-color);
            }
          </style>`

          const shadowRoot = this.attachShadow({mode: 'open'})
          shadowRoot.innerHTML = style + header + days
          // shadow dom won't work with Firefox even with pollyfil :(
          // https://unpkg.com/@webcomponents/custom-elements@latest
          // but setting this.innerHTML will :/
          // this.innerHTML = style + header + days
        }
      }
      // This registers your new tag and associates it with your class
      window.customElements.define('calendar-element', CalendarElement)
      console.log(window.cntdys.calendarMonth(2017, 6))
    </script>
  </body>
</html>