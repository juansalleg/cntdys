<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <calendar-element></calendar-element>
    <p class="week">Test leaking out styles</p>

    <!--It is a mess to get Firefox to work :(-->
    <!--<script src="https://unpkg.com/@webcomponents/custom-elements@latest"></script>-->
    <!--<script src="https://unpkg.com/@webcomponents/shadydom@latest"></script>-->
    <script src="dist/bundle.min.js"></script>
    <script>
      class CalendarElement extends HTMLElement {
        constructor() {
          super() // always call super() first in the ctor.

          // TODO: make this dynamic
          this.year = 2017
          this.month = 6

          const isCurrentMonth = (day, month) => day.month.month === month
          const isWeekend = (day) => day.dayInWeek === 6 || day.dayInWeek === 0

          const calendarDays = window.cntdys.calendarMonth(this.year, this.month)
          const days = calendarDays
            .map(week => `
              <div class="week">${week.map(day => 
                `<span class="day${isWeekend(day) ? ' weekend' : ''}${isCurrentMonth(day, this.month) ? ' current-month' : ' other-month'}">${day.dayInMonth}</span>`)
                .join('')}
              </div>`
            )
            .join('')

          const header = `<div>
            <span class="header">${this.year} - ${this.month}</span>
            <div class="week">
              <span class="day">Mo</span>
              <span class="day">Tu</span>
              <span class="day">We</span>
              <span class="day">Th</span>
              <span class="day">Fr</span>
              <span class="day">Sa</span>
              <span class="day">Su</span>
            </div>
          </div>`
          const style = `<style>
            :host {
              --main-bg-color: green;
            }

            .week {
              display: flex;
            }
            .day {
              width: 30px;
              text-align: center;
            }
            .day:hover {
              cursor: default;
            }
            .day.current-month:hover {
              cursor: pointer;
              background-color: var(--main-bg-color);
            }
            .other-month, .weekend {
              color: grey;
            }
          </style>`

          const shadowRoot = this.attachShadow({mode: 'open'})
          shadowRoot.innerHTML = style + header + days
          // shadow dom won't work with Firefox even with pollyfil :(
          // https://unpkg.com/@webcomponents/custom-elements@latest
          // but setting this.innerHTML will :/
          // this.innerHTML = style + header + days
        }
      }
      // This registers your new tag and associates it with your class
      window.customElements.define('calendar-element', CalendarElement)
      console.log(window.cntdys.calendarMonth(2017, 6))
    </script>
  </body>
</html>